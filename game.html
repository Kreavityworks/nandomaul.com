import React, { useState, useEffect } from 'react';
import { Activity, ArrowRight, Target, Crosshair, Zap } from 'lucide-react';

interface HomePageHeadProps {
    navigateTo: (page: string, section?: string) => void;
    setCursorHovering: (hovering: boolean) => void;
}

// --- 1. CSS INJECTION (COMPLEX POLYGONS & LASERS) ---
const AnimationStyles = () => (
  <style dangerouslySetInnerHTML={{__html: `
    /* Global Context */
    .perspective-container { perspective: 800px; overflow: visible; }
    .preserve-3d { transform-style: preserve-3d; }

    /* --- BACKGROUND --- */
    .bg-noise {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
    }
    @keyframes bg-pan { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }
    .animate-grid-pan { background-size: 40px 40px; animation: bg-pan 60s linear infinite; }

    /* --- 3D MAP MOTION (ORBITAL) --- */
    @keyframes map-orbit {
      0% { transform: rotateX(60deg) rotateZ(0deg) translateZ(-50px); }
      50% { transform: rotateX(50deg) rotateZ(10deg) translateZ(-30px); }
      100% { transform: rotateX(60deg) rotateZ(0deg) translateZ(-50px); }
    }
    .animate-map-orbit { animation: map-orbit 20s ease-in-out infinite; }

    /* --- LASER BEAMS --- */
    @keyframes laser-flash {
        0% { opacity: 0; width: 0; }
        10% { opacity: 1; width: 100%; }
        20% { opacity: 1; width: 100%; }
        100% { opacity: 0; width: 100%; transform: translateX(100px); }
    }
    .animate-laser-fast { animation: laser-flash 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
    .animate-laser-slow { animation: laser-flash 3s cubic-bezier(0.4, 0, 0.2, 1) infinite; }

    /* --- POLYGON/PYRAMID STYLES --- */
    .pyramid-face {
        position: absolute; width: 0; height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 30px solid rgba(0, 255, 255, 0.8);
        transform-origin: 50% 100%;
    }
    
    @keyframes float-drone {
        0%, 100% { transform: translateZ(20px) rotateZ(0deg); }
        50% { transform: translateZ(40px) rotateZ(5deg); }
    }
    .animate-drone { animation: float-drone 4s ease-in-out infinite; }

    @keyframes spin-complex {
        0% { transform: rotateY(0deg) rotateZ(0deg); }
        100% { transform: rotateY(360deg) rotateZ(360deg); }
    }
    .animate-spin-3d { animation: spin-complex 10s linear infinite; }

    /* --- MARQUEE FIX (ABSOLUTE) --- */
    @keyframes marquee-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .animate-marquee {
        display: flex;
        flex-direction: row;
        width: max-content;
        will-change: transform;
        animation: marquee-scroll 30s linear infinite;
    }

    /* --- GLITCH TEXT --- */
    .glitch-block { position: relative; display: inline-block; color: black; }
    .glitch-block::before, .glitch-block::after {
        content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: #fff; opacity: 0; pointer-events: none;
    }
    .auto-glitch::before { opacity: 1; animation: g1 0.3s infinite; color: #ff00ff; z-index: -1; transform: translate(-2px, 2px); }
    .auto-glitch::after { opacity: 1; animation: g2 0.3s infinite reverse; color: #00ffff; z-index: -2; transform: translate(2px, -2px); }
    @keyframes g1 { 0% { clip-path: inset(20% 0 80% 0); } 100% { clip-path: inset(10% 0 30% 0); } }
    @keyframes g2 { 0% { clip-path: inset(10% 0 60% 0); } 100% { clip-path: inset(30% 0 10% 0); } }

    /* Shimmer Text */
    @keyframes shimmer { 0% { background-position: -200% center; } 100% { background-position: 200% center; } }
    .animate-shimmer {
        background: linear-gradient(90deg, #1a1a1a 0%, #1a1a1a 40%, #888 50%, #1a1a1a 60%, #1a1a1a 100%);
        background-size: 200% auto; -webkit-background-clip: text; background-clip: text; color: transparent;
        animation: shimmer 5s ease-in-out infinite;
    }
    
    /* Radar Scan */
    @keyframes radar-sweep {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  `}} />
);

// --- 2. COMPONENTS ---

const GlitchLine: React.FC<{ text: string; delay?: number }> = ({ text, delay = 0 }) => {
    const [isActive, setIsActive] = useState(false);
    useEffect(() => {
        const trigger = () => {
            if(Math.random() > 0.3) { setIsActive(true); setTimeout(() => setIsActive(false), 200); }
            setTimeout(trigger, 2500 + Math.random() * 2000); 
        };
        const t = setTimeout(trigger, delay); return () => clearTimeout(t);
    }, [delay]);
    return <span className={`glitch-block ${isActive ? 'auto-glitch' : ''} block leading-[0.85]`} data-text={text}>{text}</span>;
};

// --- POLYGONAL PYRAMID (High Poly Look) ---
const Pyramid: React.FC<{ color: string, scale?: number, x: number, y: number, z: number, rot?: string }> = ({ color, scale = 1, x, y, z, rot = '0deg' }) => {
    const borderCol = color === 'cyan' ? 'rgba(0,255,255,0.6)' : 'rgba(255,0,0,0.6)';
    // Simplified triangular pyramid structure using CSS borders
    return (
        <div className="absolute preserve-3d" 
             style={{ 
                 transform: `translate3d(${x}px, ${y}px, ${z}px) rotateZ(${rot}) scale(${scale})`,
                 transformOrigin: 'bottom center' 
             }}>
             {/* Face 1 (Front) */}
             <div className="absolute top-0 left-0 w-0 h-0 border-l-[10px] border-r-[10px] border-b-[30px] border-l-transparent border-r-transparent"
                  style={{ borderBottomColor: borderCol, transform: 'rotateX(30deg) translateZ(5px)' }}></div>
             {/* Face 2 (Back) */}
             <div className="absolute top-0 left-0 w-0 h-0 border-l-[10px] border-r-[10px] border-b-[30px] border-l-transparent border-r-transparent"
                  style={{ borderBottomColor: borderCol, transform: 'rotateX(-30deg) translateZ(-5px) rotateY(180deg)' }}></div>
             {/* Face 3 (Left) */}
             <div className="absolute top-0 left-0 w-0 h-0 border-l-[10px] border-r-[10px] border-b-[30px] border-l-transparent border-r-transparent"
                  style={{ borderBottomColor: borderCol, transform: 'rotateY(90deg) rotateX(-30deg) translateZ(-5px)' }}></div>
             {/* Face 4 (Right) */}
             <div className="absolute top-0 left-0 w-0 h-0 border-l-[10px] border-r-[10px] border-b-[30px] border-l-transparent border-r-transparent"
                  style={{ borderBottomColor: borderCol, transform: 'rotateY(-90deg) rotateX(-30deg) translateZ(-5px)' }}></div>
        </div>
    );
};

// --- LASER BEAM ---
const Laser: React.FC<{ delay: number, color: string, style: React.CSSProperties }> = ({ delay, color, style }) => (
    <div className={`absolute h-[2px] ${color === 'red' ? 'bg-red-500 shadow-[0_0_10px_red]' : 'bg-cyan-400 shadow-[0_0_10px_cyan]'} ${delay < 1 ? 'animate-laser-fast' : 'animate-laser-slow'}`}
         style={{ ...style, animationDelay: `${delay}s`, transformOrigin: 'left' }}>
    </div>
);

// --- 3D WARZONE MAP ---
const CyberWarzone: React.FC = () => {
    return (
        <div className="relative w-[400px] h-[400px] preserve-3d animate-map-orbit">
            
            {/* --- MAP BASE (Wireframe Grid) --- */}
            <div className="absolute inset-0 bg-black/80 border border-cyan-500/30 rounded-full shadow-[0_0_100px_rgba(0,255,255,0.15)] preserve-3d overflow-hidden">
                <div className="absolute inset-0 bg-[linear-gradient(rgba(0,255,255,0.15)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,255,0.15)_1px,transparent_1px)] bg-[size:30px_30px]"></div>
                <div className="absolute inset-0 rounded-full border-[20px] border-cyan-900/20"></div>
                
                {/* RADAR SWEEP */}
                <div className="absolute top-1/2 left-1/2 w-[200px] h-[200px] bg-gradient-to-r from-transparent via-cyan-500/10 to-transparent origin-bottom-left"
                     style={{ animation: 'radar-sweep 4s linear infinite' }}></div>
            </div>

            {/* --- PLAYER SQUAD (Cyan Pyramids) --- */}
            <div className="absolute top-1/2 left-1/2 preserve-3d animate-drone">
                <Pyramid color="cyan" scale={1.5} x={0} y={0} z={20} />
                <Pyramid color="cyan" scale={0.8} x={-30} y={20} z={0} rot="-15deg" />
                <Pyramid color="cyan" scale={0.8} x={30} y={20} z={0} rot="15deg" />
            </div>

            {/* --- ENEMY SQUAD (Red Pyramids - Incoming) --- */}
            <div className="absolute top-0 left-1/2 preserve-3d" style={{ transform: 'translateX(-50%) translateZ(10px)' }}>
                <Pyramid color="red" scale={1.2} x={-40} y={-80} z={30} rot="180deg" />
                <Pyramid color="red" scale={1.2} x={40} y={-60} z={10} rot="170deg" />
                <Pyramid color="red" scale={1} x={0} y={-120} z={50} rot="180deg" />
            </div>

            {/* --- CHAOTIC LASER BEAMS (Crossing the map) --- */}
            {/* Player Lasers */}
            <Laser color="cyan" delay={0} style={{ top: '50%', left: '50%', width: '300px', transform: 'translateZ(20px) rotateZ(-90deg)' }} />
            <Laser color="cyan" delay={0.2} style={{ top: '50%', left: '40%', width: '300px', transform: 'translateZ(20px) rotateZ(-85deg)' }} />
            <Laser color="cyan" delay={0.4} style={{ top: '50%', left: '60%', width: '300px', transform: 'translateZ(20px) rotateZ(-95deg)' }} />

            {/* Enemy Lasers */}
            <Laser color="red" delay={0.5} style={{ top: '10%', left: '20%', width: '400px', transform: 'translateZ(30px) rotateZ(80deg)' }} />
            <Laser color="red" delay={0.7} style={{ top: '10%', left: '80%', width: '400px', transform: 'translateZ(30px) rotateZ(100deg)' }} />
            <Laser color="red" delay={1.2} style={{ top: '-10%', left: '50%', width: '500px', transform: 'translateZ(50px) rotateZ(90deg)' }} />
            
            {/* Random Crossfire */}
            <Laser color="red" delay={1.5} style={{ top: '30%', left: '-20%', width: '600px', transform: 'translateZ(10px) rotateZ(-10deg)' }} />
            <Laser color="cyan" delay={1.8} style={{ top: '60%', right: '-20%', width: '600px', transform: 'translateZ(10px) rotateZ(190deg)' }} />

            {/* --- FLOATING DEBRIS (Polygons) --- */}
            {[...Array(6)].map((_, i) => (
                <div key={i} className="absolute w-2 h-2 border border-white/40 bg-white/10 animate-spin-3d"
                     style={{
                         top: `${Math.random()*100}%`, left: `${Math.random()*100}%`,
                         transform: `translateZ(${Math.random()*60}px)`,
                         animationDuration: `${3+Math.random()*5}s`
                     }}></div>
            ))}

            {/* --- UI OVERLAYS (Holographic) --- */}
            <div className="absolute -bottom-10 right-0 w-32 border-t-2 border-red-500 bg-red-900/20 text-right p-2 transform translate-z-[80px]">
                <div className="text-[9px] text-red-400 font-mono animate-pulse">WARNING</div>
                <div className="text-xs text-white font-bold">MULTIPLE BOGEYS</div>
            </div>
             <div className="absolute -top-10 left-0 w-32 border-b-2 border-cyan-500 bg-cyan-900/20 p-2 transform translate-z-[80px]">
                <div className="text-[9px] text-cyan-400 font-mono">TARGET LOCKED</div>
                <div className="text-xs text-white font-bold">FIRING MAIN</div>
            </div>

        </div>
    );
};

// --- 3. MAIN COMPONENT ---
const HomePageHead: React.FC<HomePageHeadProps> = ({ navigateTo, setCursorHovering }) => {
  return (
    <div className="w-full bg-white font-sans text-black selection:bg-black selection:text-white overflow-hidden relative">
        <AnimationStyles />
        
        {/* --- BACKGROUND --- */}
        <div className="absolute inset-0 bg-[linear-gradient(to_right,#f0f0f0_1px,transparent_1px),linear-gradient(to_bottom,#f0f0f0_1px,transparent_1px)] animate-grid-pan pointer-events-none z-0"></div>
        <div className="absolute inset-0 bg-noise opacity-30 pointer-events-none mix-blend-multiply z-0"></div>

        <header className="relative z-10 w-full max-w-[1600px] mx-auto min-h-[90vh] flex flex-col pt-24 px-6 md:px-12 pb-4">
            
            {/* GRID LAYOUT */}
            <div className="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-0 items-start animate-reveal-soft">
                
                {/* --- LEFT: TYPOGRAPHY --- */}
                <div className="lg:col-span-7 flex flex-col pt-10 lg:pr-12">
                    {/* Top Tag */}
                    <div className="mb-6 inline-flex items-center gap-2 px-3 py-1 bg-white border border-black/10 shadow-sm animate-reveal-soft delay-100 w-fit">
                        <Activity size={12} className="text-green-600 animate-pulse" />
                        <span className="text-[10px] font-mono tracking-widest font-bold uppercase">System V.2.5 Online</span>
                    </div>

                    {/* HEADLINE */}
                    <div className="mb-8 animate-reveal-soft delay-200">
                        <div className="flex flex-wrap items-center gap-3 mb-4 font-bold tracking-tight text-neutral-800">
                            <h2 className="text-xl md:text-2xl tracking-tighter">NANDO M.</h2>
                            <span className="text-neutral-300 text-lg">//</span>
                            <h3 className="text-xs md:text-sm font-mono text-neutral-500 tracking-[0.2em] uppercase pt-0.5">
                                SYSTEM ARCHITECT | LEAD DIGITAL ENGINEER.
                            </h3>
                        </div>

                        <h1 className="text-5xl md:text-6xl lg:text-[4.5rem] font-black leading-[0.85] tracking-tighter uppercase mb-6 text-black">
                            <GlitchLine text="NOT WORKING" delay={0} />
                            <GlitchLine text="WITHIN SYSTEMS." delay={100} />
                            <GlitchLine text="BUT CREATING THEM." delay={200} />
                        </h1>
                    </div>

                    {/* Description */}
                    <div className="max-w-xl mb-10 animate-reveal-soft delay-300">
                        <p className="text-sm md:text-base font-mono leading-relaxed border-l-2 border-black pl-4 py-1 animate-text-shimmer text-neutral-800">
                            Leveraging AI-Driven Architecture to engineer high-scale, high-performance digital frameworks. Dedicated to precision and systemic efficiency. <span className="bg-black text-white px-1 mx-1 not-sr-only text-opacity-100">No shortcuts.</span> Minimizing error through structural excellence.
                        </p>
                    </div>

                    {/* Buttons */}
                    <div className="flex flex-wrap gap-4 animate-reveal-soft delay-500">
                         <button 
                            onClick={() => navigateTo('home', 'experience')}
                            onMouseEnter={() => setCursorHovering(true)}
                            onMouseLeave={() => setCursorHovering(false)}
                            className="group relative overflow-hidden bg-black text-white px-8 py-3 text-xs font-bold tracking-[0.2em] uppercase border border-black transition-all duration-300 shadow-[4px_4px_0px_rgba(0,0,0,0.15)] hover:shadow-none hover:translate-x-[1px] hover:translate-y-[1px]"
                        >
                            <span className="absolute inset-0 bg-[linear-gradient(45deg,transparent_25%,rgba(255,255,255,0.1)_50%,transparent_75%)] bg-[length:250%_250%] group-hover:bg-[position:100%_100%] transition-[background-position] duration-700 ease-in-out"></span>
                            <span className="relative z-10 flex items-center gap-2 group-hover:text-cyan-200 transition-colors">
                                View Work <ArrowRight size={14} />
                            </span>
                        </button>
                         <button className="px-8 py-3 text-xs font-bold tracking-[0.2em] uppercase border-b border-black/20 hover:border-black transition-colors bg-white hover:bg-neutral-50">
                            Contact
                        </button>
                    </div>
                </div>

                {/* --- RIGHT: 3D WARZONE (Aligned) --- */}
                <div className="lg:col-span-5 h-full flex flex-col items-center justify-start relative pt-36 lg:pt-44">
                    <CyberWarzone />
                </div>
            </div>

            {/* --- MARQUEE FIX (NOWRAP & FLEX) --- */}
            <div className="mt-auto py-3 border-t border-black/10 relative overflow-hidden bg-white/50 backdrop-blur-sm">
                <div className="animate-marquee flex flex-row items-center whitespace-nowrap min-w-full">
                     {/* Duplicate content heavily to ensure loop coverage */}
                     {[...Array(10)].map((_, i) => (
                        <div key={i} className="flex flex-row items-center mx-8 opacity-60 hover:opacity-100 transition-opacity">
                             <span className="text-xs font-bold font-mono tracking-[0.3em] text-black">UI/UX ENGINEERING</span>
                             <span className="mx-6 text-neutral-400">//</span>
                             <span className="text-xs font-bold font-mono tracking-[0.3em] text-neutral-500">SYSTEM ARCHITECTURE</span>
                             <span className="mx-6 text-neutral-400">//</span>
                        </div>
                    ))}
                </div>
            </div>
        </header>
    </div>
  );
};

export default HomePageHead;